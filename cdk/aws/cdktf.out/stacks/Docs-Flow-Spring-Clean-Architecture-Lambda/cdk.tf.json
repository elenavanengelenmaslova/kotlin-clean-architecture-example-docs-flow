{
  "//": {
    "metadata": {
      "backend": "s3",
      "stackName": "Docs-Flow-Spring-Clean-Architecture-Lambda",
      "version": "0.20.11"
    },
    "outputs": {
    }
  },
  "provider": {
    "aws": [
      {
        "region": "${var.DEPLOY_TARGET_REGION}"
      }
    ],
    "random": [
      {
      }
    ]
  },
  "resource": {
    "aws_iam_policy": {
      "DocsFlow-Spring-Clean-Architecture-Fun-Policy": {
        "//": {
          "metadata": {
            "path": "Docs-Flow-Spring-Clean-Architecture-Lambda/DocsFlow-Spring-Clean-Architecture-Fun-Policy",
            "uniqueId": "DocsFlow-Spring-Clean-Architecture-Fun-Policy"
          }
        },
        "depends_on": [
          "aws_s3_bucket.DocsFlowBucket"
        ],
        "name": "DocsFlow-Spring-Clean-Architecture-Fun-Policy",
        "policy": "{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"logs:CreateLogGroup\",\n                \"logs:CreateLogStream\",\n                \"logs:PutLogEvents\"\n            ],\n            \"Resource\": \"arn:aws:logs:*:*:*\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"s3:PutObject\",\n                \"s3:GetObject\",\n                \"s3:ListBucket\",\n                \"s3:DeleteObject\"\n            ],\n            \"Resource\": [\n                \"${aws_s3_bucket.DocsFlowBucket.arn}\",          \n                \"${aws_s3_bucket.DocsFlowBucket.arn}/*\"   \n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                 \"ses:SendEmail\",\n                 \"ses:SendRawEmail\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}"
      }
    },
    "aws_iam_role": {
      "DocsFlow-Spring-Clean-Architecture-Fun-Role": {
        "//": {
          "metadata": {
            "path": "Docs-Flow-Spring-Clean-Architecture-Lambda/DocsFlow-Spring-Clean-Architecture-Fun-Role",
            "uniqueId": "DocsFlow-Spring-Clean-Architecture-Fun-Role"
          }
        },
        "assume_role_policy": "{\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Action\": \"sts:AssumeRole\",\n                            \"Principal\": {\"Service\": \"lambda.amazonaws.com\"},\n                            \"Effect\": \"Allow\"\n                        }\n                    ]\n                }",
        "name": "DocsFlow-Spring-Clean-Architecture-Fun-Role"
      }
    },
    "aws_iam_role_policy": {
      "DocsFlow-Spring-Clean-Architecture-Fun-RolePolicy": {
        "//": {
          "metadata": {
            "path": "Docs-Flow-Spring-Clean-Architecture-Lambda/DocsFlow-Spring-Clean-Architecture-Fun-RolePolicy",
            "uniqueId": "DocsFlow-Spring-Clean-Architecture-Fun-RolePolicy"
          }
        },
        "name": "DocsFlow-Spring-Clean-Architecture-Fun-RolePolicy",
        "policy": "${aws_iam_policy.DocsFlow-Spring-Clean-Architecture-Fun-Policy.policy}",
        "role": "${aws_iam_role.DocsFlow-Spring-Clean-Architecture-Fun-Role.name}"
      }
    },
    "aws_lambda_function": {
      "DocsFlow-Document-Processor": {
        "//": {
          "metadata": {
            "path": "Docs-Flow-Spring-Clean-Architecture-Lambda/DocsFlow-Document-Processor",
            "uniqueId": "DocsFlow-Document-Processor"
          }
        },
        "depends_on": [
          "aws_s3_bucket.DocsFlowBucket",
          "aws_iam_role.DocsFlow-Spring-Clean-Architecture-Fun-Role"
        ],
        "environment": {
          "variables": {
            "AWS_S3_BUCKET_NAME": "${aws_s3_bucket.DocsFlowBucket.bucket}",
            "JAVA_TOOL_OPTIONS": "-XX:+TieredCompilation -XX:TieredStopAtLevel=1",
            "MAIN_CLASS": "com.example.clean.architecture.Application",
            "SPRING_CLOUD_FUNCTION_DEFINITION": "processDocument"
          }
        },
        "function_name": "DocsFlow-Document-Processor",
        "handler": "org.springframework.cloud.function.adapter.aws.FunctionInvoker",
        "memory_size": 1024,
        "role": "${aws_iam_role.DocsFlow-Spring-Clean-Architecture-Fun-Role.arn}",
        "runtime": "java21",
        "s3_bucket": "lambda-deployment-clean-architecture-example",
        "s3_key": "docs-flow-aws-function.jar",
        "source_code_hash": "${filebase64sha256(\"../../../../../build/dist/docs-flow-aws-function.jar\")}",
        "timeout": 120
      },
      "DocsFlow-Spring-Clean-Architecture-Fun": {
        "//": {
          "metadata": {
            "path": "Docs-Flow-Spring-Clean-Architecture-Lambda/DocsFlow-Spring-Clean-Architecture-Fun",
            "uniqueId": "DocsFlow-Spring-Clean-Architecture-Fun"
          }
        },
        "depends_on": [
          "aws_s3_bucket.DocsFlowBucket",
          "aws_iam_role.DocsFlow-Spring-Clean-Architecture-Fun-Role"
        ],
        "environment": {
          "variables": {
            "AWS_S3_BUCKET_NAME": "${aws_s3_bucket.DocsFlowBucket.bucket}",
            "JAVA_TOOL_OPTIONS": "-XX:+TieredCompilation -XX:TieredStopAtLevel=1",
            "MAIN_CLASS": "com.example.clean.architecture.Application",
            "SPRING_CLOUD_FUNCTION_DEFINITION": "uploadDocument"
          }
        },
        "function_name": "DocsFlow-Spring-Clean-Architecture-Fun",
        "handler": "org.springframework.cloud.function.adapter.aws.FunctionInvoker",
        "memory_size": 1024,
        "role": "${aws_iam_role.DocsFlow-Spring-Clean-Architecture-Fun-Role.arn}",
        "runtime": "java21",
        "s3_bucket": "lambda-deployment-clean-architecture-example",
        "s3_key": "docs-flow-aws-function.jar",
        "source_code_hash": "${filebase64sha256(\"../../../../../build/dist/docs-flow-aws-function.jar\")}",
        "timeout": 120
      }
    },
    "aws_lambda_permission": {
      "DocsFlow-S3-Permission": {
        "//": {
          "metadata": {
            "path": "Docs-Flow-Spring-Clean-Architecture-Lambda/DocsFlow-S3-Permission",
            "uniqueId": "DocsFlow-S3-Permission"
          }
        },
        "action": "lambda:InvokeFunction",
        "function_name": "${aws_lambda_function.DocsFlow-Document-Processor.function_name}",
        "principal": "s3.amazonaws.com",
        "source_arn": "${aws_s3_bucket.DocsFlowBucket.arn}"
      }
    },
    "aws_s3_bucket": {
      "DocsFlowBucket": {
        "//": {
          "metadata": {
            "path": "Docs-Flow-Spring-Clean-Architecture-Lambda/DocsFlowBucket",
            "uniqueId": "DocsFlowBucket"
          }
        },
        "bucket": "docs-flow-${random_string.bucketSuffix.result}"
      }
    },
    "aws_s3_bucket_notification": {
      "DocsFlow-S3-Notification": {
        "//": {
          "metadata": {
            "path": "Docs-Flow-Spring-Clean-Architecture-Lambda/DocsFlow-S3-Notification",
            "uniqueId": "DocsFlow-S3-Notification"
          }
        },
        "bucket": "${aws_s3_bucket.DocsFlowBucket.id}",
        "depends_on": [
          "aws_lambda_permission.DocsFlow-S3-Permission"
        ],
        "lambda_function": [
          {
            "events": [
              "s3:ObjectCreated:*"
            ],
            "lambda_function_arn": "${aws_lambda_function.DocsFlow-Document-Processor.arn}"
          }
        ]
      }
    },
    "random_string": {
      "bucketSuffix": {
        "//": {
          "metadata": {
            "path": "Docs-Flow-Spring-Clean-Architecture-Lambda/bucketSuffix",
            "uniqueId": "bucketSuffix"
          }
        },
        "length": 8,
        "numeric": false,
        "special": false,
        "upper": false
      }
    }
  },
  "terraform": {
    "backend": {
      "s3": {
        "bucket": "kotlin-lambda-terraform-state",
        "encrypt": true,
        "key": "docs-flow-terraform-cdk/terraform.tfstate",
        "region": "${region}"
      }
    },
    "required_providers": {
      "aws": {
        "source": "aws",
        "version": "5.88.0"
      },
      "random": {
        "source": "hashicorp/random",
        "version": "3.7.1"
      }
    }
  },
  "variable": {
    "DEPLOY_TARGET_ACCOUNT": {
      "description": "The AWS account",
      "type": "string"
    },
    "DEPLOY_TARGET_REGION": {
      "description": "The AWS region",
      "type": "string"
    }
  }
}